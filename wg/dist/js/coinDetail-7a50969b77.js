var vm=new Vue({el:"#app",data:{coin:{},tabIndex:0,tabs:["Overview","AI Forecast","Peers Analysis","Ratio"],regime:"Model One",factor:"BTC Factor",basic:{},ai:{},aiRegime:"Model One",aiFactor:"BTC Factor",nTrials:100,versus:{PeerStats:{peer_stats:[]}},pos:0,peer_stats_first:[],peer_stats_other:[],peerTabName:["Peers View","Side-by-Side View"],peerTabIndex:0,ratios:{},percentile:0,url:"{coin_id}",opacity:1,loading:!1},methods:{switchTab(t){this.tabIndex=t},rateColor:t=>parseFloat(t)>=0?"#20ae16":"red",coinDetail(){this.offset,this.limit,this.sort_type;axios.get(window.reqUrl+"/get/coins/detail/"+this.url,{params:{token:localStorage.getItem("token")}}).then(t=>{0==t.data.error&&(this.coin=t.data.data),403==t.data.error&&(location.href="login.html")}).catch(function(t){console.log(t)})},drawHistogram(){for(var t=[["Return","Frequency"]],e=0;e<this.basic.HistData.length;e++){var a=[];a.push(this.basic.HistData[e][0]),a.push(this.basic.HistData[e][1]),t.push(a)}var s=google.visualization.arrayToDataTable(t);new google.visualization.ColumnChart(document.getElementById("histogram")).draw(s,{colors:["#1e5adc"],title:"Histogram of Returns",hAxis:{format:"0.00%",title:"Return"},vAxis:{title:"Frequency"},legend:{position:"none"}})},drawMonthlyChart(){var t=this.basic.Columns;t.unshift("Month");for(var e=[t],a=0;a<this.basic.Data.length;a++){var s=[],i=this.basic.Data[a][0].year,r=this.basic.Data[a][0].month,o=this.basic.Data[a][0].day;s.push(new Date(i+"-"+r+"-"+o)),s.push(100*this.basic.Data[a][1][0]),e.push(s)}var n=google.visualization.arrayToDataTable(e);new google.visualization.LineChart(document.getElementById("monthly_chart")).draw(n,{colors:["#1e5adc"],title:"Cumulative Returns",hAxis:{title:"Time"},vAxis:{title:"Return"}})},drawReturns(){for(var t=[["Date",this.basic.Coin.Name,"Adjusted VaR"]],e=0;e<this.basic.HistReturns.length;e++){var a=[],s=this.basic.HistReturns[e][0].year,i=this.basic.HistReturns[e][0].month,r=this.basic.HistReturns[e][0].day;a.push(new Date(s+"-"+i+"-"+r)),a.push(this.basic.HistReturns[e][1]),a.push(this.basic.ValueAtRisk),t.push(a)}var o=google.visualization.arrayToDataTable(t);new google.visualization.ComboChart(document.getElementById("histchart")).draw(o,{title:"Historical Returns",colors:["#1e5adc","#f39800"],seriesType:"bars",series:{1:{type:"line"}},hAxis:{title:"Time"},vAxis:{format:"0.00%",title:"Daily Return"}})},drawMDD(){var t=[];if(0==this.basic.N_Benchmarks){t=[["Date",this.basic.Coin.Name]];for(var e=0;e<this.basic.UnderWater.length;e++){var a=[],s=this.basic.UnderWater[e][0].year,i=this.basic.UnderWater[e][0].month,r=this.basic.UnderWater[e][0].day;a.push(new Date(s+"-"+i+"-"+r)),a.push(this.basic.UnderWater[e][1]),t.push(a)}}else{t=[["Date","coin",this.basic.Benchmarks[0]]];for(e=0;e<this.basic.UnderWater.length;e++){a=[],s=this.basic.UnderWater[e][0].year,i=this.basic.UnderWater[e][0].month,r=this.basic.UnderWater[e][0].day;a.push(new Date(s+"-"+i+"-"+r)),a.push(this.basic.UnderWater[e][1]),a.push(this.basic.UnderWater[e][2]),t.push(a)}}var o=google.visualization.arrayToDataTable(t);new google.visualization.LineChart(document.getElementById("underwater")).draw(o,{title:"Underwater Curve",colors:["#1e5adc"],hAxis:{title:"Time"},vAxis:{format:"0.00%",title:"Loss"}})},ReturnHistogram(){for(var t=[["Return","Frequency"]],e=0;e<this.ai.ReturnHist.length;e++){var a=[];a.push(this.ai.ReturnHist[e][0]),a.push(this.ai.ReturnHist[e][1]),t.push(a)}var s=google.visualization.arrayToDataTable(t);new google.visualization.ColumnChart(document.getElementById("ret_histogram")).draw(s,{title:"Histogram of Cumulative Returns",hAxis:{format:"0.00%",title:"Return"},vAxis:{title:"Frequency"},legend:{position:"none"},width:1130,height:500,colors:["#1e5adc"]})},MDDHistogram(){for(var t=[["Return","Frequency"]],e=0;e<this.ai.MDDHist.length;e++){var a=[];a.push(this.ai.MDDHist[e][0]),a.push(this.ai.MDDHist[e][1]),t.push(a)}var s=google.visualization.arrayToDataTable(t);new google.visualization.ColumnChart(document.getElementById("mdd_histogram")).draw(s,{title:"Histogram of Simulated Drawdowns",vAxis:{title:"Frequency"},hAxis:{format:"0.00%",title:"Loss"},legend:{position:"none"},width:1130,height:500,colors:["#1e5adc"]})},drawTimeLine(){var t=document.getElementById("timeline"),e=new google.visualization.Timeline(t),a=new google.visualization.DataTable;a.addColumn({type:"string",id:"Regime"}),a.addColumn({type:"date",id:"Start"}),a.addColumn({type:"date",id:"End"});var s=[],i=this.percentile;this.ai.Results[i].regime_series.index.forEach(t=>{var e=new Date(t);e.setDate(1);var a=[this.ai.Results[i].regime_series.value[t]+"_"+i,e,new Date(t)];s.push(a)}),a.addRows(s);e.draw(a,{title:"Simulated Regimes 99th Percentile",colors:["#1e5adc"],width:815,height:200,vAxis:{title:"Regime Model"},hAxis:{title:"Time"}})},ReturnChart(){var t=this.percentile,e=[["Date","Return"]];this.ai.Results[t].return_series.index.forEach(a=>{var s=[new Date(a),this.ai.Results[t].return_series.value[a]];e.push(s)});var a=new google.visualization.arrayToDataTable(e),s={width:836,legend:{position:"none"},vAxis:{title:"Return",format:"0.00%"},hAxis:{title:"Time"},title:`Simulated Returns ${this.percentile}th Percentile`,colors:["#1e5adc"],width:1130,height:500};new google.visualization.ColumnChart(document.getElementById("monthreturn")).draw(a,s)},percent(){google.charts.setOnLoadCallback(this.drawTimeLine),google.charts.setOnLoadCallback(this.ReturnChart)},distChart(){var t=[];this.versus.PeerStats.peer_stats.forEach(function(e){var a=[e.Name,e.peer_stats.worst,e.peer_stats.mean-e.peer_stats.std,e.peer_stats.mean+e.peer_stats.std,e.peer_stats.best];t.push(a)});var e=google.visualization.arrayToDataTable(t,!0);new google.visualization.CandlestickChart(document.getElementById("distChartDiv")).draw(e,{legend:"none",title:"Return Distribution Comparison",vAxis:{format:"0.00%"},width:1140,height:500})},drawRiskReturnChart(){var t=[["ID","AnnVol","Annualized Return","Max Drawdown","Correlation"]];this.versus.PeerStats.peer_stats.forEach(e=>{var a=[e.Name,e.peer_stats.ann_std,e.peer_stats.ann_return,e.peer_stats.maxdd,e.corr];t.push(a)});var e=google.visualization.arrayToDataTable(t);new google.visualization.BubbleChart(document.getElementById("riskreturndiv")).draw(e,{title:"Risk vs. Return",hAxis:{title:"Annualized Volatility",format:"0.00%"},vAxis:{title:"Annualized Return",format:"0.00%"},bubble:{textStyle:{fontSize:11}},colorAxis:{colors:["red","green"],title:"Max DD",format:"0.00%"},width:1130,height:500})},drawBetas(t){this.betas(this.peer_stats_first[0]);for(var e=0;e<this.peer_stats_other.length;e++)this.betas(this.peer_stats_other[e])},betas(t){for(var e=[["Factor","Beta"]],a=0;a<this.versus.NFactors;a++){var s=[t.factors[a].Name,t.peer_style.betas[a]];e.push(s)}var i=new google.visualization.arrayToDataTable(e),r=document.createElement("div");r.id="style_"+t.index,document.querySelector("[name=style"+t.index+"]").appendChild(r),new google.visualization.ColumnChart(r).draw(i,{min:-1,chartArea:{width:"40%"},max:1,hAxis:{format:"0.00"},legend:{position:"none"},width:500,colors:["#1e5adc"],title:"Factor Sensitivies R-Sq: %"})},drawRegimes(t){this.regimes(this.peer_stats_first[0]);for(var e=0;e<this.peer_stats_other.length;e++)this.regimes(this.peer_stats_other[e])},regimes(t){for(var e=[["Regime","Avg Return"]],a=0;a<t.regime_stats.N;a++){var s=[t.regime_stats.regimes[a],t.regime_stats.avg.iloc[a][0]];e.push(s)}var i=new google.visualization.arrayToDataTable(e),r=document.createElement("div");r.id="regime_"+t.index,document.querySelector("[name=regime"+t.index+"]").appendChild(r),new google.visualization.ColumnChart(r).draw(i,{vAxis:{format:"0.00%"},colors:["#1e5adc"],legend:{position:"none"},title:"Regime Performance",width:500})},goUp(){this.pos<0&&(this.pos=this.pos+100,$(".slider").animate({left:this.pos+"%"}))},goDown(){this.pos>-100*(this.peer_stats_other.length-1)&&(this.pos=this.pos-100,$(".slider").animate({left:this.pos+"%"}))},getBasic(){axios.get(window.reqUrl+"/get/reports/coins/basic/"+this.url).then(t=>{0==t.data.error?(this.basic=t.data.data,google.charts.setOnLoadCallback(this.drawHistogram),google.charts.setOnLoadCallback(this.drawMonthlyChart),google.charts.setOnLoadCallback(this.drawReturns),google.charts.setOnLoadCallback(this.drawMDD)):alert(t.data.message)}).catch(function(t){console.log(t)})},getAi(){this.loading=!0,this.opacity=0,axios.get(window.reqUrl+"/get/reports/coins/ai/"+this.url,{params:{factor_code:this.aiFactor,regime_name:this.aiRegime,n_trials:this.nTrials,token:localStorage.getItem("token")}}).then(t=>{setTimeout(()=>{this.loading=!1,this.opacity=1},1500),0==t.data.error?(this.ai=t.data.data,google.charts.setOnLoadCallback(this.ReturnHistogram),google.charts.setOnLoadCallback(this.MDDHistogram),google.charts.setOnLoadCallback(this.drawTimeLine),google.charts.setOnLoadCallback(this.ReturnChart)):alert(t.data.message)}).catch(function(t){console.log(t)})},getVersus(){this.loading=!0,this.opacity=0,this.peer_stats_first=[],this.peer_stats_other=[],axios.get(window.reqUrl+"/get/reports/coins/versus/"+this.url,{params:{factor_code:this.factor,regime_name:this.regime,token:localStorage.getItem("token")}}).then(t=>{if(setTimeout(()=>{this.loading=!1,this.opacity=1},1500),0==t.data.error){this.versus=t.data.data,this.peer_stats_first.push(this.versus.PeerStats.peer_stats[0]);for(var e=1;e<this.versus.PeerStats.peer_stats.length;e++)this.peer_stats_other.push(this.versus.PeerStats.peer_stats[e]);google.charts.load("current",{packages:["gauge","corechart","bar"]}),google.charts.setOnLoadCallback(this.distChart),google.charts.setOnLoadCallback(this.drawRiskReturnChart),google.charts.setOnLoadCallback(this.drawBetas),google.charts.setOnLoadCallback(this.drawRegimes)}else alert(t.data.message),403==t.data.error&&(location.href="login.html")}).catch(function(t){console.log(t)})},getRatios(){axios.get(window.reqUrl+"/get/reports/coins/ratios/"+this.url).then(t=>{0==t.data.error?this.ratios=t.data.data:alert(t.data.message)}).catch(function(t){console.log(t)})},getQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null},peerTab(t){this.peerTabIndex=t}},created(){this.url=this.getQueryString("coin_id"),google.charts.load("current",{packages:["corechart","controls","bar","timeline","gauge"]}),this.coinDetail(),this.getBasic(),this.getAi(),this.getVersus(),this.getRatios()},computed:{roll(){for(var t=[],e=0;e<this.ratios.RollResults.length;e++){for(var a=[],s=0;s<this.ratios.RollResults[e][1].length;s++)a[this.ratios.RollResults[e][1][s][0]]=this.ratios.RollResults[e][1][s][1];t.push(a)}return t}},mounted(){}});