new Vue({el:"#app",data:{sort_type:"day_7",coinName:"",coinList:[],portfolioList:[],portfolioCount:0,coinsList:[],myPortfolio:[],folio_index:0,portfolioIndex:0,portfolioTab:["1ST","2ST","3ST"],page:{pageSize:8,currentPage:1,showItem:6,totalPage:0}},methods:{gotoCreatePortfolios(){localStorage.getItem("token")?location.href="createPortfolios.html":location.href="login.html"},confirmRemove(t){this.$confirm("Do you want to delete this portfolio?","",{confirmButtonText:"YES",cancelButtonText:"NO",type:"warning",center:!0}).then(()=>{this.removeMyPortfolio(t)}).catch(()=>{})},removeMyPortfolio(t){axios.get(window.reqUrl+"/delete/portfolio/"+t,{params:{token:localStorage.getItem("token")}}).then(t=>{0==t.data.error&&this.getMyPortfolio()}).catch(function(t){console.log(t)})},getCoinsList(){axios.get(window.reqUrl+"/get/coins/analysis").then(t=>{0==t.data.error&&(this.coinsList=t.data.data)}).catch(function(t){console.log(t)})},getMyPortfolio(){axios.get(window.reqUrl+"/get/portfolio/oneself",{params:{token:localStorage.getItem("token")}}).then(t=>{if(0==t.data.error){this.myPortfolio=t.data.data;for(let t=0;t<this.myPortfolio.length;t++)this.getBasic(this.myPortfolio[t].folio_id)}403==t.data.error&&(localStorage.removeItem("token"),this.hasToken=!1)}).catch(function(t){console.log(t)})},getPortfolioDetail(t){localStorage.getItem("token")?location.href="share.html?folio_id="+t:location.href="login.html"},changePortfolio(t){this.portfolioIndex=t},getportfolioList(){var t={offset:this.page.currentPage,limit:this.page.pageSize,sort_type:this.sort_type};axios.get(window.reqUrl+"/get/portfolio/rankinglist",{params:t}).then(t=>{0==t.data.error&&(this.portfolioList=t.data.data.items,this.portfolioCount=t.data.data.count,this.page.totalPage=t.data.data.count,this.getRoi(),this.getRoiWeek())}).catch(function(t){console.log(t)})},getCoinDetail(t){localStorage.getItem("token")?location.href="coinDetail.html?coin_id="+t:location.href="login.html"},getBasic(t){axios.get(window.reqUrl+"/get/reports/portfolio/basic/"+t,{params:{token:localStorage.getItem("token")}}).then(t=>{0==t.data.error&&(this.basic=t.data.data,google.charts.setOnLoadCallback(this.drawMonthlyChart))}).catch(function(t){console.log(t)})},drawMonthlyChart(){for(var t=["Month"],o=0;o<this.basic.Columns.length;o++)t.push(this.basic.Columns[o]);t.push({type:"boolean",role:"scope"});var e=[t];for(o=0;o<this.basic.Data.length;o++){var i=[],a=this.basic.Data[o][0].year,r=this.basic.Data[o][0].month,s=this.basic.Data[o][0].day;i.push(new Date(a+"-"+r+"-"+s)),i.push(100*this.basic.Data[o][1][0]),i.push(this.basic.Data[o][2]),e.push(i)}var l=google.visualization.arrayToDataTable(e),n=new google.visualization.LineChart(document.getElementById("monthly_chart_"+this.basic.folio_id));this.folio_index=this.folio_index+1,n.draw(l,{legend:{position:"none"},chartArea:{margin:"auto"},backgroundColor:"transparent",colors:["#1e5adc"],width:585,height:400})},combinate(t){var o=[];return t.forEach((t,e)=>{var i="";t.allocations.forEach((t,o)=>{i=i+t.coin_name+" "+t.weight+"  "}),o.push(i)}),o},goto(t){t!=this.page.currentPage&&(this.page.currentPage=t,this.getportfolioList())},rateColor:t=>parseFloat(t)>=0?"#20ae16":"red",getRoi(){this.portfolioList.forEach(t=>{t.roi=t.entire_history})},getRoiWeek(){this.portfolioList.forEach(t=>{t.roiWeek=t.day_7_history})}},created(){google.charts.load("current",{packages:["corechart"]}),setTimeout(this.getMyPortfolio,1e3),this.getportfolioList(),this.getCoinsList()},mounted(){},computed:{roi(){for(var t=[],o=0;o<this.portfolioList.length;o++){var e=parseFloat(this.portfolioList[o].roi)>=0?"#20ae16":"red";t.push(e)}return t},roiWeek(){for(var t=[],o=0;o<this.portfolioList.length;o++){var e=parseFloat(this.portfolioList[o].roiWeek)>=0?"#20ae16":"red";t.push(e)}return t},max_drawdown(){for(var t=[],o=0;o<this.portfolioList.length;o++){var e=parseFloat(this.portfolioList[o].max_drawdown)>=0?"#20ae16":"red";t.push(e)}return t},combinations:function(){return this.combinate(this.portfolioList)},mycombinations(){return this.combinate(this.myPortfolio)},rois(){for(var t=[],o=0;o<this.myPortfolio.length;o++){var e=parseFloat(this.myPortfolio[o].hour_24_history)>=0?"#20ae16":"red";t.push(e)}return t}},watch:{sort_type(){this.getportfolioList()}}});