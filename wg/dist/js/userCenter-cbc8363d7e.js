var vm=new Vue({el:"#app",data(){return{user_navs:["Account","Security"],nav_index:0,userCenter:{head_img_url:"img/w5.png",userName:localStorage.getItem("referName")},token:localStorage.getItem("token"),followProjects:[],isEdit:!1,isActive:!1,isShowBar:!1,pcUploadUrl:window.pcUploadUrl,ruleForm2:{oldPass:"",pass:"",checkPass:""},rules2:{oldPass:[{required:!0,message:"please enter your current password",trigger:"blur"}],pass:[{required:!0,validator:(e,t,r)=>{""===t?r(new Error("please enter your password")):/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,18}$/.test(t)?(""!==this.ruleForm2.checkPass&&this.$refs.ruleForm2.validateField("checkPass"),r()):r(new Error("Need to include letters and numbers, at least 6 digits, up to 18 digits"))},trigger:"blur"}],checkPass:[{required:!0,validator:(e,t,r)=>{""===t?r(new Error("please enter your password")):t!==this.ruleForm2.pass?r(new Error("The two input passwords do not match.!")):r()},trigger:"blur"}]}}},methods:{handleAvatarSuccess(e,t){this.imageUrl=URL.createObjectURL(t.raw)},beforeAvatarUpload(e){const t="image/jpeg"===e.type||"image/png"===e.type||"image/gif"===e.type,r=e.size/1024/1024<2;return t||this.$message.error("Please upload jpg, jpeg or png picture"),r||this.$message.error("Please upload a file size not more than 2MB"),t&&r},getQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(t);return null!=r?unescape(r[2]):null},tab(e){this.nav_index=e},edit(){this.isEdit=!this.isEdit},editUserDetail(e){axios.post(window.pcUrl,{actionCode:"editUserDetail",token:localStorage.getItem("token"),nickName:e.nickName,headImgUrl:e.headImgUrl,loginPassword:e.loginPassword,oldPassword:e.oldPassword}).then(function(e){alert(e.data.meta.msg)}).catch(function(e){console.log(e)})},handleAvatarSuccess(e){if(0==e.meta.errno){this.userCenter.head_img_url=e.result.data+"?ver="+Math.random();var t={nickName:this.userCenter.userName,headImgUrl:this.userCenter.head_img_url};this.editUserDetail(t),localStorage.setItem("head_img_url",this.userCenter.head_img_url),this.$children[0].head_img_url=this.userCenter.head_img_url}},saveName(){var e={nickName:this.userCenter.userName,headImgUrl:this.userCenter.head_img_url};this.editUserDetail(e),this.isEdit=!1},savePassword(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;var t={loginPassword:$.md5(this.ruleForm2.pass),oldPassword:$.md5(this.ruleForm2.oldPass)};this.editUserDetail(t)})},queryUserDetail(){axios.post(window.pcUrl,{actionCode:"queryUserDetail",token:localStorage.getItem("token")}).then(e=>{var t=e.data;0==t.meta.errno?(this.userCenter=t.result.data,this.getActiveStatus(),this.userCenter.userName&&localStorage.setItem("referName",this.userCenter.userName),this.userCenter.head_img_url&&localStorage.setItem("head_img_url",this.userCenter.head_img_url)):alert(t.meta.msg)}).catch(function(e){console.log(e)})},validate(){return this.currentPassword?this.newPassword?this.confimPassword?!(this.newPassword=!this.confimPassword)||(alert("two passwords are different"),!1):(alert("confim password is empity"),!1):(alert("new password is empity"),!1):(alert("current password is empity"),!1)},getActiveStatus(){this.getQueryString("activateCode")?axios.post(window.pcUrl,{actionCode:"mailActivate",token:localStorage.getItem("token"),activateCode:this.getQueryString("activateCode"),mailId:this.getQueryString("mailId")}).then(e=>{var t=e.data;0==t.meta.errno?($(".user-active").fadeIn(),setTimeout(function(){$(".user-active").fadeOut()},2e3),this.$confirm("Congratulations! You can now create your first portfolio!","success",{confirmButtonText:"Create Your Own Portfolio",showCancelButton:!1,type:"success",center:!0}).then(()=>{location.href="createPortfolios.html"}).catch(()=>{})):alert(t.meta.msg)}).catch(function(e){console.log(e)}):2==this.userCenter.status?(this.isActive=!1,this.isShowBar=!0):this.isShowBar=!1},resend(){axios.post(window.pcUrl,{actionCode:"sendActivateMail",token:localStorage.getItem("token")}).then(function(e){alert(e.data.meta.msg)}).catch(function(e){console.log(e)})}},created:function(){this.getQueryString("token")&&localStorage.setItem("token",this.getQueryString("token")),this.queryUserDetail()}});